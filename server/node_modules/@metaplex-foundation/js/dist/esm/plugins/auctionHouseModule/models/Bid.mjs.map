{"version":3,"file":"Bid.mjs","sources":["../../../../../src/plugins/auctionHouseModule/models/Bid.ts"],"sourcesContent":["import { PublicKey } from '@solana/web3.js';\nimport { BidReceiptAccount } from '../accounts';\nimport { Nft, NftWithToken, Sft, SftWithToken } from '../../nftModule';\nimport { AuctionHouse } from './AuctionHouse';\nimport {\n  amount,\n  BigNumber,\n  DateTime,\n  lamports,\n  Pda,\n  SolAmount,\n  SplTokenAmount,\n  toBigNumber,\n  toDateTime,\n  toOptionDateTime,\n} from '@/types';\nimport { assert, Option } from '@/utils';\n\n/** @group Models */\nexport type Bid = Readonly<\n  {\n    /** A model identifier to distinguish models in the SDK. */\n    model: 'bid';\n\n    /**\n     * Whether or not the asset was loaded.\n     * When this is `false`, it means the Bid includes asset model.\n     */\n    lazy: false;\n\n    /** A model of the Auction House related to this bid. */\n    auctionHouse: AuctionHouse;\n\n    /** The address of the buyer's trade state account. */\n    tradeStateAddress: Pda;\n\n    /** The address of the buyer's wallet. */\n    buyerAddress: PublicKey;\n\n    /**\n     * The address of the bookkeeper account.\n     * It is responsible for signing a Bid Receipt Print.\n     */\n    bookkeeperAddress: Option<PublicKey>;\n\n    /**\n     * The address of the bid receipt account.\n     * This is the account that stores information about this bid.\n     * The Bid model is built on top of this account.\n     */\n    receiptAddress: Option<Pda>;\n\n    /**\n     * The address of the purchase receipt account.\n     * This is the account that stores information about the purchase related to this bid.\n     *\n     * ```ts\n     * const transactionBuilder = metaplex\n     *   .auctionHouse()\n     *   .builders()\n     *   .findPurchaseByReceipt({ auctionHouse, receiptAddress: purchaseReceiptAddress });\n     * ```\n     */\n    purchaseReceiptAddress: Option<PublicKey>;\n\n    /** The buyer's price. */\n    price: SolAmount | SplTokenAmount;\n\n    /** The number of tokens bid is for. */\n    tokens: SplTokenAmount;\n\n    /** The date of creation. */\n    createdAt: DateTime;\n\n    /** The date of cancellation. */\n    canceledAt: Option<DateTime>;\n  } & (\n    | {\n        /** The bid is not public, which means that it was created according to the listing. */\n        isPublic: false;\n\n        /** The Nft or Sft with the associated token account. */\n        asset: SftWithToken | NftWithToken;\n      }\n    | {\n        /**\n         * The bid is public.\n         * This means that a bid can stay active beyond the end of an auction\n         * and be resolved if it meets the criteria for subsequent auctions of that token.\n         */\n        isPublic: true;\n\n        /** The Nft or Sft related to the Bid. */\n        asset: Sft | Nft;\n      }\n  )\n>;\n\n/** @group Model Helpers */\nexport const isBid = (value: any): value is Bid =>\n  typeof value === 'object' && value.model === 'bid' && !value.lazy;\n\n/** @group Model Helpers */\nexport function assertBid(value: any): asserts value is Bid {\n  assert(isBid(value), `Expected Bid type`);\n}\n\n/** @group Model Helpers */\nexport const toBid = (\n  account: BidReceiptAccount,\n  auctionHouse: AuctionHouse,\n  asset: Nft | Sft | NftWithToken | SftWithToken\n): Bid => {\n  const lazyBid = toLazyBid(account, auctionHouse);\n\n  return {\n    ...lazyBid,\n    model: 'bid',\n    lazy: false,\n    ...('token' in asset\n      ? {\n          asset,\n          tokens: amount(lazyBid.tokens, asset.mint.currency),\n          isPublic: false,\n        }\n      : {\n          asset,\n          tokens: amount(lazyBid.tokens, asset.mint.currency),\n          isPublic: true,\n        }),\n  };\n};\n\n/** @group Models */\nexport type PublicBid = Bid & { isPublic: true; asset: Sft | Nft };\n\n/** @group Models */\nexport type PrivateBid = Bid & {\n  isPublic: false;\n  asset: SftWithToken | NftWithToken;\n};\n\n/** @group Model Helpers */\nexport const isPrivateBid = (value: any): value is PrivateBid =>\n  typeof value === 'object' && value.model === 'bid' && !value.isPublic;\n\nexport type LazyBid = Omit<Bid, 'lazy' | 'asset' | 'tokens'> &\n  Readonly<{\n    lazy: true;\n    metadataAddress: PublicKey;\n    tokenAddress: Option<PublicKey>;\n    tokens: BigNumber;\n  }>;\n\n/** @group Model Helpers */\nexport const isLazyBid = (value: any): value is LazyBid =>\n  typeof value === 'object' && value.model === 'bid' && value.lazy;\n\n/** @group Model Helpers */\nexport function assertLazyBid(value: any): asserts value is LazyBid {\n  assert(isLazyBid(value), `Expected LazyBid type`);\n}\n\n/** @group Model Helpers */\nexport const toLazyBid = (\n  account: BidReceiptAccount,\n  auctionHouse: AuctionHouse\n): LazyBid => {\n  return {\n    model: 'bid',\n    lazy: true,\n    auctionHouse,\n    tradeStateAddress: new Pda(\n      account.data.tradeState,\n      account.data.tradeStateBump\n    ),\n    bookkeeperAddress: account.data.bookkeeper,\n    buyerAddress: account.data.buyer,\n    metadataAddress: account.data.metadata,\n    tokenAddress: account.data.tokenAccount,\n    receiptAddress: new Pda(account.publicKey, account.data.bump),\n    purchaseReceiptAddress: account.data.purchaseReceipt,\n    isPublic: Boolean(account.data.tokenAccount),\n\n    // Data.\n    price: auctionHouse.isNative\n      ? lamports(account.data.price)\n      : amount(account.data.price, auctionHouse.treasuryMint.currency),\n    tokens: toBigNumber(account.data.tokenSize),\n    createdAt: toDateTime(account.data.createdAt),\n    canceledAt: toOptionDateTime(account.data.canceledAt),\n  };\n};\n"],"names":["isBid","value","model","lazy","assertBid","assert","toBid","account","auctionHouse","asset","lazyBid","toLazyBid","tokens","amount","mint","currency","isPublic","isPrivateBid","isLazyBid","assertLazyBid","tradeStateAddress","Pda","data","tradeState","tradeStateBump","bookkeeperAddress","bookkeeper","buyerAddress","buyer","metadataAddress","metadata","tokenAddress","tokenAccount","receiptAddress","publicKey","bump","purchaseReceiptAddress","purchaseReceipt","Boolean","price","isNative","lamports","treasuryMint","toBigNumber","tokenSize","createdAt","toDateTime","canceledAt","toOptionDateTime"],"mappings":"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"}