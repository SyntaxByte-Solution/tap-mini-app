{"version":3,"file":"createMint.mjs","sources":["../../../../../src/plugins/tokenModule/operations/createMint.ts"],"sourcesContent":["import { createInitializeMintInstruction, MINT_SIZE } from '@solana/spl-token';\nimport { Keypair, PublicKey } from '@solana/web3.js';\nimport { SendAndConfirmTransactionResponse } from '../../rpcModule';\nimport { Mint } from '../models/Mint';\nimport { Option, TransactionBuilder, TransactionBuilderOptions } from '@/utils';\nimport {\n  makeConfirmOptionsFinalizedOnMainnet,\n  Operation,\n  OperationHandler,\n  OperationScope,\n  Signer,\n  useOperation,\n} from '@/types';\nimport type { Metaplex } from '@/Metaplex';\n\n// -----------------\n// Operation\n// -----------------\n\nconst Key = 'CreateMintOperation' as const;\n\n/**\n * Creates a new mint account.\n *\n * ```ts\n * const { mint } = await metaplex.tokens().createMint();\n * ```\n *\n * @group Operations\n * @category Constructors\n */\nexport const createMintOperation = useOperation<CreateMintOperation>(Key);\n\n/**\n * @group Operations\n * @category Types\n */\nexport type CreateMintOperation = Operation<\n  typeof Key,\n  CreateMintInput,\n  CreateMintOutput\n>;\n\n/**\n * @group Operations\n * @category Inputs\n */\nexport type CreateMintInput = {\n  /**\n   * The number of decimal points used to define token amounts.\n   *\n   * @defaultValue `0`\n   */\n  decimals?: number;\n\n  /**\n   * The address of the new mint account as a Signer.\n   *\n   * @defaultValue `Keypair.generate()`\n   */\n  mint?: Signer;\n\n  /**\n   * The address of the authority that is allowed\n   * to mint new tokens to token accounts.\n   *\n   * @defaultValue `metaplex.identity().publicKey`\n   */\n  mintAuthority?: PublicKey;\n\n  /**\n   * The address of the authority that is allowed\n   * to freeze token accounts.\n   *\n   * @defaultValue Defaults to using the same value as the\n   * `mintAuthority` parameter.\n   */\n  freezeAuthority?: Option<PublicKey>;\n};\n\n/**\n * Create a new Mint account from the provided input\n * and returns the newly created `Mint` model.\n *\n * @group Operations\n * @category Outputs\n */\nexport type CreateMintOutput = {\n  /** The blockchain response from sending and confirming the transaction. */\n  response: SendAndConfirmTransactionResponse;\n\n  /** The mint account as a Signer. */\n  mintSigner: Signer;\n\n  /** The created mint account. */\n  mint: Mint;\n};\n\n/**\n * @group Operations\n * @category Handlers\n */\nexport const createMintOperationHandler: OperationHandler<CreateMintOperation> =\n  {\n    async handle(\n      operation: CreateMintOperation,\n      metaplex: Metaplex,\n      scope: OperationScope\n    ): Promise<CreateMintOutput> {\n      const builder = await createMintBuilder(metaplex, operation.input, scope);\n      scope.throwIfCanceled();\n\n      const confirmOptions = makeConfirmOptionsFinalizedOnMainnet(\n        metaplex,\n        scope.confirmOptions\n      );\n      const output = await builder.sendAndConfirm(metaplex, confirmOptions);\n      scope.throwIfCanceled();\n\n      const mint = await metaplex\n        .tokens()\n        .findMintByAddress({ address: output.mintSigner.publicKey }, scope);\n\n      return { ...output, mint };\n    },\n  };\n\n// -----------------\n// Builder\n// -----------------\n\n/**\n * @group Transaction Builders\n * @category Inputs\n */\nexport type CreateMintBuilderParams = Omit<\n  CreateMintInput,\n  'confirmOptions'\n> & {\n  /** A key to distinguish the instruction that creates the account. */\n  createAccountInstructionKey?: string;\n\n  /** A key to distinguish the instruction that initializes the mint account. */\n  initializeMintInstructionKey?: string;\n};\n\n/**\n * @group Transaction Builders\n * @category Contexts\n */\nexport type CreateMintBuilderContext = Omit<\n  CreateMintOutput,\n  'response' | 'mint'\n>;\n\n/**\n * Creates a new mint account.\n *\n * ```ts\n * const transactionBuilder = await metaplex.tokens().builders().createMint();\n * ```\n *\n * @group Transaction Builders\n * @category Constructors\n */\nexport const createMintBuilder = async (\n  metaplex: Metaplex,\n  params: CreateMintBuilderParams,\n  options: TransactionBuilderOptions = {}\n): Promise<TransactionBuilder<CreateMintBuilderContext>> => {\n  const { programs, payer = metaplex.rpc().getDefaultFeePayer() } = options;\n  const {\n    decimals = 0,\n    mint = Keypair.generate(),\n    mintAuthority = metaplex.identity().publicKey,\n    freezeAuthority = mintAuthority,\n  } = params;\n\n  const tokenProgram = metaplex.programs().getToken(programs);\n\n  return (\n    TransactionBuilder.make<CreateMintBuilderContext>()\n      .setFeePayer(payer)\n      .setContext({ mintSigner: mint })\n\n      // Create an empty account for the mint.\n      .add(\n        await metaplex\n          .system()\n          .builders()\n          .createAccount(\n            {\n              newAccount: mint,\n              space: MINT_SIZE,\n              program: tokenProgram.address,\n              instructionKey:\n                params.createAccountInstructionKey ?? 'createAccount',\n            },\n            { payer, programs }\n          )\n      )\n\n      // Initialize the mint.\n      .add({\n        instruction: createInitializeMintInstruction(\n          mint.publicKey,\n          decimals,\n          mintAuthority,\n          freezeAuthority,\n          tokenProgram.address\n        ),\n        signers: [mint],\n        key: params.initializeMintInstructionKey ?? 'initializeMint',\n      })\n  );\n};\n"],"names":["Key","createMintOperation","useOperation","createMintOperationHandler","handle","operation","metaplex","scope","builder","createMintBuilder","input","throwIfCanceled","confirmOptions","makeConfirmOptionsFinalizedOnMainnet","output","sendAndConfirm","mint","tokens","findMintByAddress","address","mintSigner","publicKey","params","options","programs","payer","rpc","getDefaultFeePayer","decimals","Keypair","generate","mintAuthority","identity","freezeAuthority","tokenProgram","getToken","TransactionBuilder","make","setFeePayer","setContext","add","system","builders","createAccount","newAccount","space","MINT_SIZE","program","instructionKey","createAccountInstructionKey","instruction","createInitializeMintInstruction","signers","key","initializeMintInstructionKey"],"mappings":"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"}