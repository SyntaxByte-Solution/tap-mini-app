{"version":3,"file":"findListings.cjs","sources":["../../../../../src/plugins/auctionHouseModule/operations/findListings.ts"],"sourcesContent":["import { PublicKey } from '@solana/web3.js';\nimport { toListingReceiptAccount } from '../accounts';\nimport { ListingReceiptGpaBuilder } from '../gpaBuilders';\nimport { AuctionHouse, LazyListing, Listing, toLazyListing } from '../models';\nimport {\n  Operation,\n  OperationHandler,\n  OperationScope,\n  useOperation,\n} from '@/types';\nimport { Metaplex } from '@/Metaplex';\n\n// -----------------\n// Operation\n// -----------------\n\nconst Key = 'FindListingsOperation' as const;\n\n/**\n * Finds Listings by multiple criteria.\n * You can use any combination of keys.\n *\n * ```ts\n * // Find all listings in an Auction House.\n * const listings = await metaplex\n *   .auctionHouse()\n *   .findListings({ auctionHouse });\n *\n * // Find listings by seller and mint.\n * const listings = await metaplex\n *   .auctionHouse()\n *   .findListings({ auctionHouse, seller, mint });\n * ```\n *\n * @group Operations\n * @category Constructors\n */\nexport const findListingsOperation = useOperation<FindListingsOperation>(Key);\n\n/**\n * @group Operations\n * @category Types\n */\nexport type FindListingsOperation = Operation<\n  typeof Key,\n  FindListingsInput,\n  FindListingsOutput\n>;\n\n/**\n * @group Operations\n * @category Inputs\n */\nexport type FindListingsInput = {\n  /** A model of the Auction House related to these listings. */\n  auctionHouse: AuctionHouse;\n\n  /** The address of a seller to search by. */\n  seller?: PublicKey;\n\n  /**\n   * The address of metadata to search by.\n   * Ignored when mint provided.\n   */\n  metadata?: PublicKey;\n\n  /** The address of a mint to search by. */\n  mint?: PublicKey;\n};\n\n/**\n * @group Operations\n * @category Outputs\n */\nexport type FindListingsOutput = (Listing | LazyListing)[];\n\n/**\n * @group Operations\n * @category Handlers\n */\nexport const findListingsOperationHandler: OperationHandler<FindListingsOperation> =\n  {\n    handle: async (\n      operation: FindListingsOperation,\n      metaplex: Metaplex,\n      scope: OperationScope\n    ): Promise<FindListingsOutput> => {\n      const { commitment, programs } = scope;\n      const { auctionHouse, seller, metadata, mint } = operation.input;\n      const auctionHouseProgram = metaplex.programs().getAuctionHouse(programs);\n\n      let listingQuery = new ListingReceiptGpaBuilder(\n        metaplex,\n        auctionHouseProgram.address\n      )\n        .mergeConfig({ commitment })\n        .whereAuctionHouse(auctionHouse.address);\n\n      if (seller) {\n        listingQuery = listingQuery.whereSeller(seller);\n      }\n\n      if (metadata && !mint) {\n        listingQuery = listingQuery.whereMetadata(metadata);\n      }\n\n      if (mint) {\n        listingQuery = listingQuery.whereMetadata(\n          metaplex.nfts().pdas().metadata({ mint, programs })\n        );\n      }\n\n      scope.throwIfCanceled();\n\n      return listingQuery.getAndMap((account) =>\n        toLazyListing(toListingReceiptAccount(account), auctionHouse)\n      );\n    },\n  };\n"],"names":["Key","findListingsOperation","useOperation","findListingsOperationHandler","handle","operation","metaplex","scope","commitment","programs","auctionHouse","seller","metadata","mint","input","auctionHouseProgram","getAuctionHouse","listingQuery","ListingReceiptGpaBuilder","address","mergeConfig","whereAuctionHouse","whereSeller","whereMetadata","nfts","pdas","throwIfCanceled","getAndMap","account","toLazyListing","toListingReceiptAccount"],"mappings":";;;;;;;;;AAYA;AACA;AACA;;AAEA,MAAMA,GAAG,GAAG,uBAAgC,CAAA;;AAE5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACaC,qBAAqB,GAAGC,sBAAY,CAAwBF,GAAG,EAAC;;AAE7E;AACA;AACA;AACA;;AAkCA;AACA;AACA;AACA;AACO,MAAMG,4BAAqE,GAChF;AACEC,EAAAA,MAAM,EAAE,OACNC,SAAgC,EAChCC,QAAkB,EAClBC,KAAqB,KACW;IAChC,MAAM;MAAEC,UAAU;AAAEC,MAAAA,QAAAA;AAAS,KAAC,GAAGF,KAAK,CAAA;IACtC,MAAM;MAAEG,YAAY;MAAEC,MAAM;MAAEC,QAAQ;AAAEC,MAAAA,IAAAA;KAAM,GAAGR,SAAS,CAACS,KAAK,CAAA;IAChE,MAAMC,mBAAmB,GAAGT,QAAQ,CAACG,QAAQ,EAAE,CAACO,eAAe,CAACP,QAAQ,CAAC,CAAA;AAEzE,IAAA,IAAIQ,YAAY,GAAG,IAAIC,iDAAwB,CAC7CZ,QAAQ,EACRS,mBAAmB,CAACI,OAAO,CAC5B,CACEC,WAAW,CAAC;AAAEZ,MAAAA,UAAAA;AAAW,KAAC,CAAC,CAC3Ba,iBAAiB,CAACX,YAAY,CAACS,OAAO,CAAC,CAAA;AAE1C,IAAA,IAAIR,MAAM,EAAE;AACVM,MAAAA,YAAY,GAAGA,YAAY,CAACK,WAAW,CAACX,MAAM,CAAC,CAAA;AACjD,KAAA;AAEA,IAAA,IAAIC,QAAQ,IAAI,CAACC,IAAI,EAAE;AACrBI,MAAAA,YAAY,GAAGA,YAAY,CAACM,aAAa,CAACX,QAAQ,CAAC,CAAA;AACrD,KAAA;AAEA,IAAA,IAAIC,IAAI,EAAE;AACRI,MAAAA,YAAY,GAAGA,YAAY,CAACM,aAAa,CACvCjB,QAAQ,CAACkB,IAAI,EAAE,CAACC,IAAI,EAAE,CAACb,QAAQ,CAAC;QAAEC,IAAI;AAAEJ,QAAAA,QAAAA;AAAS,OAAC,CAAC,CACpD,CAAA;AACH,KAAA;IAEAF,KAAK,CAACmB,eAAe,EAAE,CAAA;AAEvB,IAAA,OAAOT,YAAY,CAACU,SAAS,CAAEC,OAAO,IACpCC,qBAAa,CAACC,gCAAuB,CAACF,OAAO,CAAC,EAAElB,YAAY,CAAC,CAC9D,CAAA;AACH,GAAA;AACF;;;;;"}