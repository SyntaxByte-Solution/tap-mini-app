"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const ethereum_1 = __importDefault(require("./ethereum"));
const near_1 = __importDefault(require("./near"));
const solana_1 = __importDefault(require("./solana"));
const erc20_1 = __importDefault(require("./erc20"));
const axios_1 = __importDefault(require("axios"));
const utils_1 = __importDefault(require("../../common/utils"));
const aptos_1 = __importDefault(require("./aptos"));
const ethersv5_1 = require("../providers/ethereum/ethersv5");
const ethersv6_1 = require("../providers/ethereum/ethersv6");
function getTokenConfig(config) {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
    switch (config.token) {
        case "ethereum":
            return resolveProvider("ethereum", config.providerName, {
                irys: config.irys,
                name: "ethereum",
                ticker: "ETH",
                providerUrl: (_a = config.providerUrl) !== null && _a !== void 0 ? _a : "https://cloudflare-eth.com/",
                wallet: config.wallet,
            });
        case "matic":
            return resolveProvider("ethereum", config.providerName, {
                irys: config.irys,
                name: "matic",
                ticker: "MATIC",
                providerUrl: (_b = config.providerUrl) !== null && _b !== void 0 ? _b : "https://polygon-rpc.com",
                wallet: config.wallet,
                minConfirm: 1,
            });
        case "arbitrum":
            return resolveProvider("ethereum", config.providerName, {
                irys: config.irys,
                name: "arbitrum",
                ticker: "ETH",
                providerUrl: (_c = config.providerUrl) !== null && _c !== void 0 ? _c : "https://arb1.arbitrum.io/rpc",
                wallet: config.wallet,
            });
        case "bnb":
            return resolveProvider("ethereum", config.providerName, {
                irys: config.irys,
                name: "bnb",
                ticker: "BNB",
                providerUrl: (_d = config.providerUrl) !== null && _d !== void 0 ? _d : "https://bsc-dataseed.binance.org",
                wallet: config.wallet,
            });
        case "avalanche":
            return resolveProvider("ethereum", config.providerName, {
                irys: config.irys,
                name: "avalanche",
                ticker: "AVAX",
                providerUrl: (_e = config.providerUrl) !== null && _e !== void 0 ? _e : "https://api.avax.network/ext/bc/C/rpc",
                wallet: config.wallet,
            });
        case "boba-eth":
            return resolveProvider("ethereum", config.providerName, {
                irys: config.irys,
                name: "boba-eth",
                ticker: "ETH",
                providerUrl: (_f = config.providerUrl) !== null && _f !== void 0 ? _f : "https://mainnet.boba.network/",
                minConfirm: 1,
                wallet: config.wallet,
            });
        case "boba": {
            const k = new erc20_1.default({
                irys: config.irys,
                name: "boba",
                ticker: "BOBA",
                providerUrl: (_g = config.providerUrl) !== null && _g !== void 0 ? _g : "https://mainnet.boba.network/",
                contractAddress: (_h = config.contractAddress) !== null && _h !== void 0 ? _h : "0xa18bF3994C0Cc6E3b63ac420308E5383f53120D7",
                minConfirm: 1,
                wallet: config.wallet,
            });
            // for L1 mainnet: "https://main-light.eth.linkpool.io/" and "0x42bbfa2e77757c645eeaad1655e0911a7553efbc"
            k.price = () => __awaiter(this, void 0, void 0, function* () {
                var _m;
                const res = yield axios_1.default.post("https://api.livecoinwatch.com/coins/single", JSON.stringify({ currency: "USD", code: `${k.ticker}` }), {
                    headers: { "x-api-key": "75a7a824-6577-45e6-ad86-511d590c7cc8", "content-type": "application/json" },
                });
                yield utils_1.default.checkAndThrow(res, "Getting price data");
                if (!((_m = res === null || res === void 0 ? void 0 : res.data) === null || _m === void 0 ? void 0 : _m.rate)) {
                    throw new Error(`unable to get price for ${k.name}`);
                }
                return +res.data.rate;
            });
            return k;
        }
        case "solana":
            return new solana_1.default({
                irys: config.irys,
                name: "solana",
                ticker: "SOL",
                providerUrl: (_j = config.providerUrl) !== null && _j !== void 0 ? _j : "https://api.mainnet-beta.solana.com/",
                wallet: config.wallet,
            });
        // case "algorand":
        //     return new AlgorandConfig({ name: "algorand", ticker: "ALGO", providerUrl: config.providerUrl ?? "https://api.mainnet-beta.solana.com/", wallet: config.wallet })
        case "near":
            return new near_1.default({
                irys: config.irys,
                name: "near",
                ticker: "NEAR",
                providerUrl: (_k = config.providerUrl) !== null && _k !== void 0 ? _k : "https://rpc.mainnet.near.org",
                wallet: config.wallet,
            });
        case "aptos":
            return new aptos_1.default({
                irys: config.irys,
                name: "aptos",
                ticker: "APTOS",
                providerUrl: (_l = config.providerUrl) !== null && _l !== void 0 ? _l : "https://fullnode.mainnet.aptoslabs.com/v1",
                wallet: config.wallet,
            });
        default:
            throw new Error(`Unknown/Unsupported token ${config.token}`);
    }
}
exports.default = getTokenConfig;
// @ts-expect-error todo fix
function resolveProvider(family, providerName, config) {
    switch (family) {
        case "ethereum":
            switch (providerName) {
                case "ethersv5":
                    return new ethersv5_1.EthereumEthersV5(config);
                case "ethersv6":
                    return new ethersv6_1.EthereumEthersV6(config);
                default:
                    return new ethereum_1.default(config);
            }
    }
}
//# sourceMappingURL=index.js.map