{"version":3,"file":"createBid.mjs","sources":["../../../../../src/plugins/auctionHouseModule/operations/createBid.ts"],"sourcesContent":["import {\n  BuyInstructionAccounts,\n  createAuctioneerBuyInstruction,\n  createAuctioneerPublicBuyInstruction,\n  createBuyInstruction,\n  createPrintBidReceiptInstruction,\n  createPublicBuyInstruction,\n} from '@metaplex-foundation/mpl-auction-house';\nimport { PublicKey, SYSVAR_INSTRUCTIONS_PUBKEY } from '@solana/web3.js';\nimport { SendAndConfirmTransactionResponse } from '../../rpcModule';\nimport { AuctioneerAuthorityRequiredError } from '../errors';\nimport { AuctionHouse, Bid, LazyBid } from '../models';\nimport { Option, TransactionBuilder, TransactionBuilderOptions } from '@/utils';\nimport {\n  amount,\n  isSigner,\n  lamports,\n  makeConfirmOptionsFinalizedOnMainnet,\n  now,\n  Operation,\n  OperationHandler,\n  OperationScope,\n  Pda,\n  Signer,\n  SolAmount,\n  SplTokenAmount,\n  token,\n  toPublicKey,\n  useOperation,\n} from '@/types';\nimport type { Metaplex } from '@/Metaplex';\n\n// -----------------\n// Operation\n// -----------------\n\nconst Key = 'CreateBidOperation' as const;\n\n/**\n * Creates a bid on a given asset.\n *\n * You can post a public bid on a non-listed NFT by skipping seller and tokenAccount properties.\n * Public bids are specific to the token itself and not to any specific auction.\n * This means that a bid can stay active beyond the end of an auction\n * and be resolved if it meets the criteria for subsequent auctions of that token.\n *\n *\n * ```ts\n * await metaplex\n *   .auctionHouse()\n *   .bid({ auctionHouse, mintAccount, seller };\n * ```\n *\n * @group Operations\n * @category Constructors\n */\nexport const createBidOperation = useOperation<CreateBidOperation>(Key);\n\n/**\n * @group Operations\n * @category Types\n */\nexport type CreateBidOperation = Operation<\n  typeof Key,\n  CreateBidInput,\n  CreateBidOutput\n>;\n\n/**\n * @group Operations\n * @category Inputs\n */\nexport type CreateBidInput = {\n  /** The Auction House in which to create a Bid. */\n  auctionHouse: AuctionHouse;\n\n  /**\n   * Creator of a bid.\n   *\n   * @defaultValue `metaplex.identity()`\n   */\n  buyer?: Signer;\n\n  /**\n   * The Auction House authority.\n   * If this is Signer the transaction fee\n   * will be paid from the Auction House Fee Account\n   *\n   * @defaultValue `auctionHouse.authority`\n   */\n  authority?: PublicKey | Signer;\n\n  /**\n   * The Auctioneer authority key.\n   * It is required when Auction House has Auctioneer enabled.\n   *\n   * @defaultValue No default value.\n   */\n  auctioneerAuthority?: Signer;\n\n  /**\n   * The mint account to create a bid for.\n   * This is used to find the metadata.\n   */\n  mintAccount: PublicKey;\n\n  /**\n   * The account address that holds the asset a bid created is for.\n   * If this or tokenAccount isn't provided, then the bid will be public.\n   *\n   * @defaultValue No default value.\n   */\n  seller?: Option<PublicKey>;\n\n  /**\n   * The token account address that's associated to the asset a bid created is for.\n   * If this or seller isn't provided, then the bid will be public.\n   *\n   * @defaultValue No default value.\n   */\n  tokenAccount?: Option<PublicKey>;\n\n  /**\n   * The buyer's price.\n   *\n   * @defaultValue 0 SOLs or tokens.\n   */\n  price?: SolAmount | SplTokenAmount;\n\n  /**\n   * The number of tokens to bid for.\n   * For an NFT bid it must be 1 token.\n   *\n   * When a Fungible Asset is put on sale.\n   * The buyer can then create a buy order of said assets that is\n   * less than the token_size of the sell order.\n   *\n   * @defaultValue 1 token.\n   */\n  tokens?: SplTokenAmount;\n\n  /**\n   * Prints the bid receipt.\n   * The receipt holds information about the bid,\n   * So it's important to print it if you want to use the `Bid` model\n   *\n   * The receipt printing is skipped for the Auctioneer Auction House\n   * Since it currently doesn't support it.\n   *\n   * @defaultValue `true`\n   */\n  printReceipt?: boolean;\n\n  /**\n   * The address of the bookkeeper wallet responsible for the receipt.\n   *\n   * @defaultValue `metaplex.identity()`\n   */\n  bookkeeper?: Signer;\n};\n\n/**\n * @group Operations\n * @category Outputs\n */\nexport type CreateBidOutput = {\n  /** Buyer trade state account PDA encoding the bid order. */\n  buyerTradeState: Pda;\n\n  /** The asset's token account address in case the bid is private. */\n  tokenAccount: Option<PublicKey>;\n\n  /** The asset's metadata PDA. */\n  metadata: Pda;\n\n  /** The potential buyer of the asset. */\n  buyer: PublicKey;\n\n  /** The PDA of the receipt account in case it was printed. */\n  receipt: Option<Pda>;\n\n  /** The address of the bookkeeper wallet responsible for the receipt. */\n  bookkeeper: Option<PublicKey>;\n\n  /** The buyer's price. */\n  price: SolAmount | SplTokenAmount;\n\n  /** The number of tokens to bid for. */\n  tokens: SplTokenAmount;\n\n  /** A model that keeps information about the Bid. */\n  bid: Bid;\n\n  /** The blockchain response from sending and confirming the transaction. */\n  response: SendAndConfirmTransactionResponse;\n};\n\n/**\n * @group Operations\n * @category Handlers\n */\nexport const createBidOperationHandler: OperationHandler<CreateBidOperation> = {\n  async handle(\n    operation: CreateBidOperation,\n    metaplex: Metaplex,\n    scope: OperationScope\n  ): Promise<CreateBidOutput> {\n    const { auctionHouse } = operation.input;\n\n    const builder = await createBidBuilder(metaplex, operation.input, scope);\n    const confirmOptions = makeConfirmOptionsFinalizedOnMainnet(\n      metaplex,\n      scope.confirmOptions\n    );\n    const output = await builder.sendAndConfirm(metaplex, confirmOptions);\n    scope.throwIfCanceled();\n\n    if (output.receipt) {\n      const bid = await metaplex\n        .auctionHouse()\n        .findBidByReceipt(\n          { auctionHouse, receiptAddress: output.receipt },\n          scope\n        );\n\n      return { bid, ...output };\n    }\n\n    scope.throwIfCanceled();\n    const lazyBid: LazyBid = {\n      model: 'bid',\n      lazy: true,\n      auctionHouse,\n      tradeStateAddress: output.buyerTradeState,\n      bookkeeperAddress: output.bookkeeper,\n      tokenAddress: output.tokenAccount,\n      buyerAddress: output.buyer,\n      metadataAddress: output.metadata,\n      receiptAddress: output.receipt,\n      purchaseReceiptAddress: null,\n      isPublic: Boolean(output.tokenAccount),\n      price: output.price,\n      tokens: output.tokens.basisPoints,\n      createdAt: now(),\n      canceledAt: null,\n    };\n\n    return {\n      bid: await metaplex.auctionHouse().loadBid({ lazyBid }, scope),\n      ...output,\n    };\n  },\n};\n\n// -----------------\n// Builder\n// -----------------\n\n/**\n * @group Transaction Builders\n * @category Inputs\n */\nexport type CreateBidBuilderParams = Omit<CreateBidInput, 'confirmOptions'> & {\n  instructionKey?: string;\n};\n\n/**\n * @group Transaction Builders\n * @category Contexts\n */\nexport type CreateBidBuilderContext = Omit<CreateBidOutput, 'response' | 'bid'>;\n\n/**\n * Creates a bid on a given asset.\n *\n * You can post a public bid on a non-listed NFT by skipping seller and tokenAccount properties.\n * Public bids are specific to the token itself and not to any specific auction.\n * This means that a bid can stay active beyond the end of an auction\n * and be resolved if it meets the criteria for subsequent auctions of that token.\n *\n *\n * ```ts\n * const transactionBuilder = metaplex\n *   .auctionHouse()\n *   .builders()\n *   .createBid({ auctionHouse, mintAccount, seller })\n * ```\n *\n * @group Transaction Builders\n * @category Constructors\n */\nexport const createBidBuilder = async (\n  metaplex: Metaplex,\n  params: CreateBidBuilderParams,\n  options: TransactionBuilderOptions = {}\n): Promise<TransactionBuilder<CreateBidBuilderContext>> => {\n  // Data.\n  const { programs, payer = metaplex.rpc().getDefaultFeePayer() } = options;\n  const { auctionHouse } = params;\n  const tokens = params.tokens ?? token(1);\n  const priceBasisPoint = params.price?.basisPoints ?? 0;\n  const price = auctionHouse.isNative\n    ? lamports(priceBasisPoint)\n    : amount(priceBasisPoint, auctionHouse.treasuryMint.currency);\n\n  if (auctionHouse.hasAuctioneer && !params.auctioneerAuthority) {\n    throw new AuctioneerAuthorityRequiredError();\n  }\n\n  // Accounts.\n  const buyer = params.buyer ?? (metaplex.identity() as Signer);\n  const authority = params.authority ?? auctionHouse.authorityAddress;\n  const metadata = metaplex.nfts().pdas().metadata({\n    mint: params.mintAccount,\n    programs,\n  });\n  const paymentAccount = auctionHouse.isNative\n    ? toPublicKey(buyer)\n    : metaplex\n        .tokens()\n        .pdas()\n        .associatedTokenAccount({\n          mint: auctionHouse.treasuryMint.address,\n          owner: toPublicKey(buyer),\n          programs,\n        });\n  const escrowPayment = metaplex\n    .auctionHouse()\n    .pdas()\n    .buyerEscrow({\n      auctionHouse: auctionHouse.address,\n      buyer: toPublicKey(buyer),\n      programs,\n    });\n  const tokenAccount =\n    params.tokenAccount ??\n    (params.seller\n      ? metaplex.tokens().pdas().associatedTokenAccount({\n          mint: params.mintAccount,\n          owner: params.seller,\n          programs,\n        })\n      : null);\n  const buyerTokenAccount = metaplex\n    .tokens()\n    .pdas()\n    .associatedTokenAccount({\n      mint: params.mintAccount,\n      owner: toPublicKey(buyer),\n      programs,\n    });\n\n  const buyerTradeState = metaplex\n    .auctionHouse()\n    .pdas()\n    .tradeState({\n      auctionHouse: auctionHouse.address,\n      wallet: toPublicKey(buyer),\n      treasuryMint: auctionHouse.treasuryMint.address,\n      tokenMint: params.mintAccount,\n      price: price.basisPoints,\n      tokenSize: tokens.basisPoints,\n      tokenAccount,\n      programs,\n    });\n\n  const accounts: Omit<BuyInstructionAccounts, 'tokenAccount'> = {\n    wallet: toPublicKey(buyer),\n    paymentAccount,\n    transferAuthority: toPublicKey(buyer),\n    treasuryMint: auctionHouse.treasuryMint.address,\n    metadata,\n    escrowPaymentAccount: escrowPayment,\n    authority: toPublicKey(authority),\n    auctionHouse: auctionHouse.address,\n    auctionHouseFeeAccount: auctionHouse.feeAccountAddress,\n    buyerTradeState,\n  };\n\n  // Args.\n  const args = {\n    tradeStateBump: buyerTradeState.bump,\n    escrowPaymentBump: escrowPayment.bump,\n    buyerPrice: price.basisPoints,\n    tokenSize: tokens.basisPoints,\n  };\n\n  // Sell Instruction.\n  let buyInstruction = tokenAccount\n    ? createBuyInstruction({ ...accounts, tokenAccount }, args)\n    : createPublicBuyInstruction(\n        { ...accounts, tokenAccount: buyerTokenAccount },\n        args\n      );\n\n  if (params.auctioneerAuthority) {\n    const ahAuctioneerPda = metaplex.auctionHouse().pdas().auctioneer({\n      auctionHouse: auctionHouse.address,\n      auctioneerAuthority: params.auctioneerAuthority.publicKey,\n      programs,\n    });\n\n    const accountsWithAuctioneer = {\n      ...accounts,\n      auctioneerAuthority: params.auctioneerAuthority.publicKey,\n      ahAuctioneerPda,\n    };\n\n    buyInstruction = tokenAccount\n      ? createAuctioneerBuyInstruction(\n          { ...accountsWithAuctioneer, tokenAccount },\n          args\n        )\n      : createAuctioneerPublicBuyInstruction(\n          {\n            ...accountsWithAuctioneer,\n            tokenAccount: buyerTokenAccount,\n          },\n          args\n        );\n  }\n\n  // Signers.\n  const buySigners = [buyer, authority, params.auctioneerAuthority].filter(\n    isSigner\n  );\n\n  // Update the accounts to be signers since it's not covered properly by MPL due to its dynamic nature.\n  buySigners.forEach((signer) => {\n    const signerKeyIndex = buyInstruction.keys.findIndex(({ pubkey }) =>\n      pubkey.equals(signer.publicKey)\n    );\n\n    buyInstruction.keys[signerKeyIndex].isSigner = true;\n  });\n\n  // Receipt.\n  // Since createPrintBidReceiptInstruction can't deserialize createAuctioneerBuyInstruction due to a bug\n  // Don't print Auctioneer Bid receipt for the time being.\n  const shouldPrintReceipt =\n    (params.printReceipt ?? true) && !params.auctioneerAuthority;\n  const bookkeeper = params.bookkeeper ?? metaplex.identity();\n  const receipt = metaplex.auctionHouse().pdas().bidReceipt({\n    tradeState: buyerTradeState,\n    programs,\n  });\n\n  const builder = TransactionBuilder.make<CreateBidBuilderContext>()\n    .setFeePayer(payer)\n    .setContext({\n      buyerTradeState,\n      tokenAccount,\n      metadata,\n      buyer: toPublicKey(buyer),\n      receipt: shouldPrintReceipt ? receipt : null,\n      bookkeeper: shouldPrintReceipt ? bookkeeper.publicKey : null,\n      price,\n      tokens,\n    });\n\n  // Create a TA for public bid if it doesn't exist\n  if (!tokenAccount) {\n    const account = await metaplex.rpc().getAccount(buyerTokenAccount);\n    if (!account.exists) {\n      builder.add(\n        await metaplex\n          .tokens()\n          .builders()\n          .createToken({\n            mint: params.mintAccount,\n            owner: toPublicKey(buyer),\n          })\n      );\n    }\n  }\n\n  return (\n    builder\n      // Create bid.\n      .add({\n        instruction: buyInstruction,\n        signers: buySigners,\n        key: 'buy',\n      })\n\n      // Print the Bid Receipt.\n      .when(shouldPrintReceipt, (builder) =>\n        builder.add({\n          instruction: createPrintBidReceiptInstruction(\n            {\n              receipt,\n              bookkeeper: bookkeeper.publicKey,\n              instruction: SYSVAR_INSTRUCTIONS_PUBKEY,\n            },\n            { receiptBump: receipt.bump }\n          ),\n          signers: [bookkeeper],\n          key: 'printBidReceipt',\n        })\n      )\n  );\n};\n"],"names":["Key","createBidOperation","useOperation","createBidOperationHandler","handle","operation","metaplex","scope","auctionHouse","input","builder","createBidBuilder","confirmOptions","makeConfirmOptionsFinalizedOnMainnet","output","sendAndConfirm","throwIfCanceled","receipt","bid","findBidByReceipt","receiptAddress","lazyBid","model","lazy","tradeStateAddress","buyerTradeState","bookkeeperAddress","bookkeeper","tokenAddress","tokenAccount","buyerAddress","buyer","metadataAddress","metadata","purchaseReceiptAddress","isPublic","Boolean","price","tokens","basisPoints","createdAt","now","canceledAt","loadBid","params","options","programs","payer","rpc","getDefaultFeePayer","token","priceBasisPoint","isNative","lamports","amount","treasuryMint","currency","hasAuctioneer","auctioneerAuthority","AuctioneerAuthorityRequiredError","identity","authority","authorityAddress","nfts","pdas","mint","mintAccount","paymentAccount","toPublicKey","associatedTokenAccount","address","owner","escrowPayment","buyerEscrow","seller","buyerTokenAccount","tradeState","wallet","tokenMint","tokenSize","accounts","transferAuthority","escrowPaymentAccount","auctionHouseFeeAccount","feeAccountAddress","args","tradeStateBump","bump","escrowPaymentBump","buyerPrice","buyInstruction","createBuyInstruction","createPublicBuyInstruction","ahAuctioneerPda","auctioneer","publicKey","accountsWithAuctioneer","createAuctioneerBuyInstruction","createAuctioneerPublicBuyInstruction","buySigners","filter","isSigner","forEach","signer","signerKeyIndex","keys","findIndex","pubkey","equals","shouldPrintReceipt","printReceipt","bidReceipt","TransactionBuilder","make","setFeePayer","setContext","account","getAccount","exists","add","builders","createToken","instruction","signers","key","when","createPrintBidReceiptInstruction","SYSVAR_INSTRUCTIONS_PUBKEY","receiptBump"],"mappings":"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"}