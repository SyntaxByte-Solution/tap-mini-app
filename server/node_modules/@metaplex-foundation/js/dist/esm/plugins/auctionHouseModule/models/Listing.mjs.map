{"version":3,"file":"Listing.mjs","sources":["../../../../../src/plugins/auctionHouseModule/models/Listing.ts"],"sourcesContent":["import { PublicKey } from '@solana/web3.js';\nimport { ListingReceiptAccount } from '../accounts';\nimport { NftWithToken, SftWithToken } from '../../nftModule';\nimport { AuctionHouse } from './AuctionHouse';\nimport { assert, Option } from '@/utils';\nimport {\n  amount,\n  BigNumber,\n  DateTime,\n  lamports,\n  Pda,\n  SolAmount,\n  SplTokenAmount,\n  toBigNumber,\n  toDateTime,\n  toOptionDateTime,\n} from '@/types';\n\n/** @group Models */\nexport type Listing = Readonly<{\n  /** A model identifier to distinguish models in the SDK. */\n  model: 'listing';\n\n  /**\n   * Whether or not the asset was loaded.\n   * When this is `false`, it means the Listing includes asset model.\n   */\n  lazy: false;\n\n  /** A model of the Auction House related to this listing. */\n  auctionHouse: AuctionHouse;\n\n  /** The Nft or Sft with the associated token account. */\n  asset: NftWithToken | SftWithToken;\n\n  /** The address of the seller's trade state account. */\n  tradeStateAddress: Pda;\n\n  /** The address of the seller's wallet. */\n  sellerAddress: PublicKey;\n\n  /**\n   * The address of the bookkeeper account.\n   * It is responsible for signing a Listing Receipt Print.\n   */\n  bookkeeperAddress: Option<PublicKey>;\n\n  /**\n   * The address of the listing receipt account.\n   * This is the account that stores information about this listing.\n   * The Listing model is built on top of this account.\n   */\n  receiptAddress: Option<Pda>;\n\n  /**\n   * The address of the purchase receipt account.\n   * This is the account that stores information about the purchase related to this listing.\n   *\n   * ```ts\n   * const transactionBuilder = metaplex\n   *   .auctionHouse()\n   *   .builders()\n   *   .findPurchaseByReceipt({ auctionHouse, receiptAddress: purchaseReceiptAddress });\n   * ```\n   */\n  purchaseReceiptAddress: Option<PublicKey>;\n\n  /** The sellers's price. */\n  price: SolAmount | SplTokenAmount;\n\n  /** The number of tokens listed in case it's a sale of a Fungible Token. */\n  tokens: SplTokenAmount;\n\n  /** The date of creation. */\n  createdAt: DateTime;\n\n  /** The date of cancellation. */\n  canceledAt: Option<DateTime>;\n}>;\n\n/** @group Model Helpers */\nexport const isListing = (value: any): value is Listing =>\n  typeof value === 'object' && value.model === 'listing' && !value.lazy;\n\n/** @group Model Helpers */\nexport function assertListing(value: any): asserts value is Listing {\n  assert(isListing(value), `Expected Listing type`);\n}\n\n/** @group Model Helpers */\nexport const toListing = (\n  account: ListingReceiptAccount,\n  auctionHouse: AuctionHouse,\n  asset: NftWithToken | SftWithToken\n): Listing => {\n  const lazyListing = toLazyListing(account, auctionHouse);\n  return {\n    ...lazyListing,\n    model: 'listing',\n    lazy: false,\n    asset,\n    tokens: amount(lazyListing.tokens, asset.mint.currency),\n  };\n};\n\nexport type LazyListing = Omit<Listing, 'lazy' | 'asset' | 'tokens'> &\n  Readonly<{\n    lazy: true;\n    metadataAddress: PublicKey;\n    tokens: BigNumber;\n  }>;\n\n/** @group Model Helpers */\nexport const isLazyListing = (value: any): value is LazyListing =>\n  typeof value === 'object' && value.model === 'listing' && value.lazy;\n\n/** @group Model Helpers */\nexport function assertLazyListing(value: any): asserts value is LazyListing {\n  assert(isLazyListing(value), `Expected LazyListing type`);\n}\n\n/** @group Model Helpers */\nexport const toLazyListing = (\n  account: ListingReceiptAccount,\n  auctionHouse: AuctionHouse\n): LazyListing => {\n  return {\n    model: 'listing',\n    lazy: true,\n    auctionHouse,\n    tradeStateAddress: new Pda(\n      account.data.tradeState,\n      account.data.tradeStateBump\n    ),\n    bookkeeperAddress: account.data.bookkeeper,\n    sellerAddress: account.data.seller,\n    metadataAddress: account.data.metadata,\n    receiptAddress: new Pda(account.publicKey, account.data.bump),\n    purchaseReceiptAddress: account.data.purchaseReceipt,\n\n    // Data.\n    price: auctionHouse.isNative\n      ? lamports(account.data.price)\n      : amount(account.data.price, auctionHouse.treasuryMint.currency),\n    tokens: toBigNumber(account.data.tokenSize),\n    createdAt: toDateTime(account.data.createdAt),\n    canceledAt: toOptionDateTime(account.data.canceledAt),\n  };\n};\n"],"names":["isListing","value","model","lazy","assertListing","assert","toListing","account","auctionHouse","asset","lazyListing","toLazyListing","tokens","amount","mint","currency","isLazyListing","assertLazyListing","tradeStateAddress","Pda","data","tradeState","tradeStateBump","bookkeeperAddress","bookkeeper","sellerAddress","seller","metadataAddress","metadata","receiptAddress","publicKey","bump","purchaseReceiptAddress","purchaseReceipt","price","isNative","lamports","treasuryMint","toBigNumber","tokenSize","createdAt","toDateTime","canceledAt","toOptionDateTime"],"mappings":";;;;;;AAkBA;;AA8DA;MACaA,SAAS,GAAIC,KAAU,IAClC,OAAOA,KAAK,KAAK,QAAQ,IAAIA,KAAK,CAACC,KAAK,KAAK,SAAS,IAAI,CAACD,KAAK,CAACE,KAAI;;AAEvE;AACO,SAASC,aAAa,CAACH,KAAU,EAA4B;AAClEI,EAAAA,MAAM,CAACL,SAAS,CAACC,KAAK,CAAC,EAAG,uBAAsB,CAAC,CAAA;AACnD,CAAA;;AAEA;AACO,MAAMK,SAAS,GAAG,CACvBC,OAA8B,EAC9BC,YAA0B,EAC1BC,KAAkC,KACtB;AACZ,EAAA,MAAMC,WAAW,GAAGC,aAAa,CAACJ,OAAO,EAAEC,YAAY,CAAC,CAAA;EACxD,OAAO;AACL,IAAA,GAAGE,WAAW;AACdR,IAAAA,KAAK,EAAE,SAAS;AAChBC,IAAAA,IAAI,EAAE,KAAK;IACXM,KAAK;IACLG,MAAM,EAAEC,MAAM,CAACH,WAAW,CAACE,MAAM,EAAEH,KAAK,CAACK,IAAI,CAACC,QAAQ,CAAA;GACvD,CAAA;AACH,EAAC;AASD;MACaC,aAAa,GAAIf,KAAU,IACtC,OAAOA,KAAK,KAAK,QAAQ,IAAIA,KAAK,CAACC,KAAK,KAAK,SAAS,IAAID,KAAK,CAACE,KAAI;;AAEtE;AACO,SAASc,iBAAiB,CAAChB,KAAU,EAAgC;AAC1EI,EAAAA,MAAM,CAACW,aAAa,CAACf,KAAK,CAAC,EAAG,2BAA0B,CAAC,CAAA;AAC3D,CAAA;;AAEA;MACaU,aAAa,GAAG,CAC3BJ,OAA8B,EAC9BC,YAA0B,KACV;EAChB,OAAO;AACLN,IAAAA,KAAK,EAAE,SAAS;AAChBC,IAAAA,IAAI,EAAE,IAAI;IACVK,YAAY;AACZU,IAAAA,iBAAiB,EAAE,IAAIC,GAAG,CACxBZ,OAAO,CAACa,IAAI,CAACC,UAAU,EACvBd,OAAO,CAACa,IAAI,CAACE,cAAc,CAC5B;AACDC,IAAAA,iBAAiB,EAAEhB,OAAO,CAACa,IAAI,CAACI,UAAU;AAC1CC,IAAAA,aAAa,EAAElB,OAAO,CAACa,IAAI,CAACM,MAAM;AAClCC,IAAAA,eAAe,EAAEpB,OAAO,CAACa,IAAI,CAACQ,QAAQ;AACtCC,IAAAA,cAAc,EAAE,IAAIV,GAAG,CAACZ,OAAO,CAACuB,SAAS,EAAEvB,OAAO,CAACa,IAAI,CAACW,IAAI,CAAC;AAC7DC,IAAAA,sBAAsB,EAAEzB,OAAO,CAACa,IAAI,CAACa,eAAe;AAEpD;IACAC,KAAK,EAAE1B,YAAY,CAAC2B,QAAQ,GACxBC,QAAQ,CAAC7B,OAAO,CAACa,IAAI,CAACc,KAAK,CAAC,GAC5BrB,MAAM,CAACN,OAAO,CAACa,IAAI,CAACc,KAAK,EAAE1B,YAAY,CAAC6B,YAAY,CAACtB,QAAQ,CAAC;IAClEH,MAAM,EAAE0B,WAAW,CAAC/B,OAAO,CAACa,IAAI,CAACmB,SAAS,CAAC;IAC3CC,SAAS,EAAEC,UAAU,CAAClC,OAAO,CAACa,IAAI,CAACoB,SAAS,CAAC;AAC7CE,IAAAA,UAAU,EAAEC,gBAAgB,CAACpC,OAAO,CAACa,IAAI,CAACsB,UAAU,CAAA;GACrD,CAAA;AACH;;;;"}