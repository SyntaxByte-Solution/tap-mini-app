{"version":3,"file":"MockStorageDriver.mjs","sources":["../../../../src/plugins/mockStorage/MockStorageDriver.ts"],"sourcesContent":["import { MetaplexFile, StorageDriver } from '../storageModule';\nimport { Amount, BigNumber, lamports, toBigNumber } from '@/types';\nimport { AssetNotFoundError } from '@/errors';\n\nconst DEFAULT_BASE_URL = 'https://mockstorage.example.com/';\nconst DEFAULT_COST_PER_BYTE = 1;\n\nexport type MockStorageOptions = {\n  baseUrl?: string;\n  costPerByte?: BigNumber | number;\n};\n\nexport class MockStorageDriver implements StorageDriver {\n  protected cache: Record<string, MetaplexFile> = {};\n  public readonly baseUrl: string;\n  public readonly costPerByte: BigNumber;\n\n  constructor(options?: MockStorageOptions) {\n    this.baseUrl = options?.baseUrl ?? DEFAULT_BASE_URL;\n    this.costPerByte = toBigNumber(\n      options?.costPerByte != null\n        ? options?.costPerByte\n        : DEFAULT_COST_PER_BYTE\n    );\n  }\n\n  async getUploadPrice(bytes: number): Promise<Amount> {\n    return lamports(this.costPerByte.muln(bytes));\n  }\n\n  async upload(file: MetaplexFile): Promise<string> {\n    const uri = `${this.baseUrl}${file.uniqueName}`;\n    this.cache[uri] = file;\n\n    return uri;\n  }\n\n  async download(uri: string): Promise<MetaplexFile> {\n    const file = this.cache[uri];\n\n    if (!file) {\n      throw new AssetNotFoundError(uri);\n    }\n\n    return file;\n  }\n}\n"],"names":["DEFAULT_BASE_URL","DEFAULT_COST_PER_BYTE","MockStorageDriver","constructor","options","baseUrl","costPerByte","toBigNumber","getUploadPrice","bytes","lamports","muln","upload","file","uri","uniqueName","cache","download","AssetNotFoundError"],"mappings":";;;;;AAIA,MAAMA,gBAAgB,GAAG,kCAAkC,CAAA;AAC3D,MAAMC,qBAAqB,GAAG,CAAC,CAAA;AAOxB,MAAMC,iBAAiB,CAA0B;EAKtDC,WAAW,CAACC,OAA4B,EAAE;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,OAAA,EAJM,EAAE,CAAA,CAAA;AAKhD,IAAA,IAAI,CAACC,OAAO,GAAGD,OAAO,EAAEC,OAAO,IAAIL,gBAAgB,CAAA;AACnD,IAAA,IAAI,CAACM,WAAW,GAAGC,WAAW,CAC5BH,OAAO,EAAEE,WAAW,IAAI,IAAI,GACxBF,OAAO,EAAEE,WAAW,GACpBL,qBAAqB,CAC1B,CAAA;AACH,GAAA;EAEA,MAAMO,cAAc,CAACC,KAAa,EAAmB;IACnD,OAAOC,QAAQ,CAAC,IAAI,CAACJ,WAAW,CAACK,IAAI,CAACF,KAAK,CAAC,CAAC,CAAA;AAC/C,GAAA;EAEA,MAAMG,MAAM,CAACC,IAAkB,EAAmB;IAChD,MAAMC,GAAG,GAAI,CAAA,EAAE,IAAI,CAACT,OAAQ,CAAEQ,EAAAA,IAAI,CAACE,UAAW,CAAC,CAAA,CAAA;AAC/C,IAAA,IAAI,CAACC,KAAK,CAACF,GAAG,CAAC,GAAGD,IAAI,CAAA;AAEtB,IAAA,OAAOC,GAAG,CAAA;AACZ,GAAA;EAEA,MAAMG,QAAQ,CAACH,GAAW,EAAyB;AACjD,IAAA,MAAMD,IAAI,GAAG,IAAI,CAACG,KAAK,CAACF,GAAG,CAAC,CAAA;IAE5B,IAAI,CAACD,IAAI,EAAE;AACT,MAAA,MAAM,IAAIK,kBAAkB,CAACJ,GAAG,CAAC,CAAA;AACnC,KAAA;AAEA,IAAA,OAAOD,IAAI,CAAA;AACb,GAAA;AACF;;;;"}